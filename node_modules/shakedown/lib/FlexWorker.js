export default class FlexWorker {
    constructor(mid) {
        this.mid = mid;
        this.onmessage = function(){};
        this.started = false;
    }

    postMessage(message) {
        var isBrowser = typeof window != 'undefined';

        if (isBrowser){
            //create web worker
            if (!this.started){
                this.started = true;
                this.child = new Worker(this.mid)
            }
            this.child.postMessage(message);
        }

        if (!isBrowser){
            //use node child_process fork
            if (!this.started){
                this.started = true;
                this.child = System.node.child_process.fork(System.baseUrl + '/_es6ify.js');
                this.child.on('message', function(message){
                    this.onmessage({data: message})
                }.bind(this))
            }
            this.child.send({mid: this.mid, message: message});
        }
    }
}
