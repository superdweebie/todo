require('es6-module-loader').System;
var path = require('path');

System.baseUrl = path.normalize(__dirname);

System.paths['sd/*'] = System.baseUrl + '/*.js';

System.node = {};
[
    'fs',
    'child_process'
].forEach(function(module){System.node[module] = require(module)})

var launch = function(mid, method, args, callback){
    System.import(mid).then(
        function(module){
            method = method || 'default';
            args = args || [];
            args.push(callback);

            module[method].apply(null, args)
        },
        function(err){
            console.log(err);
            callback(err);
        }
    )
}

process.on('message', function(args) {
    if (!global.postMessage){
        global.postMessage = function(message){
            process.send(message);
        }
    }

    System.import(args.mid).then(
        function(){
            onmessage({data: args.message});
        },
        function(err){
            console.log(err);
        }
    )
})

module.exports = launch;