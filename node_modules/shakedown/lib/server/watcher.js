var fs = require('fs');
var watchers = {};

listener = function(event, filename) {
    console.log('CHANGED: ' + filename);
    process.send({event: event, filename: filename})
}

process.on('message', function(args) {
    if (args.watch){
        watchers[args.filename] = fs.watch(filename, null, listener);
    } else if (args.unwatch && watchers[args.filename]){
        watchers[args.filename].close();
        delete(watchers[args.filename]);
    }
})
