import {isBrowser} from 'up/env';

var fork = System.require('child_process').fork;

export default (mid) => {

    var child;
    var postMessage;
    var result = {
        mid: mid,
        onmessage: () => {}
    }

    if (isBrowser) {
        child = new Worker(mid);
        postMessage = child.postMessage;
    } else {
        child = fork(System.locate({name: 'up/_es6ify'}));
        child.on('message', (message) => {
            result.onmessage({data: message})
        });
        postMessage = (message) => {
            child.send({mid: mid, message: message})
        }
    }

    result.postMessage = postMessage;
    return result;
}
