import callbackAngel from 'up/callbackAngel';
import {load} from 'up/yaml';
import mixin from 'up/mixin';
import text from 'up/text';

var defaultConfigPath = 'up';
var configFilename = 'config.yaml';

export default () => {
    return (callback) => {

        callbackAngel(function* (){
            var pack = yield text('package.json');
            pack = JSON.parse(pack);

            var result = yield [`${defaultConfigPath}/${configFilename}`, 'lib/' + configFilename].map((item) => {return load(item)});
            result = mixin({name: pack.name, version: pack.version}, ...result);

            delete(result['']);

            System.addConfig(result);

            callback(result);
        });
    }
};
